from flask import render_template, request
from app.auth.permissions import require_permission
from app.blueprints import events
from saq.database.model import Malware
from saq.database.pool import get_db
from aceapi_v2.sync import run_async_with_session
from aceapi_v2.threat_types.service import get_threat_types

@events.route('/new_malware_option', methods=['POST', 'GET'])
@require_permission('event', 'write')
def new_malware_option():
    index = request.args['index']
    malware = get_db().query(Malware).order_by(Malware.name.asc()).all()
    threat_types = run_async_with_session(get_threat_types)
    return render_template('events/new_malware_option.html', malware=malware, index=index, threat_types=threat_types)